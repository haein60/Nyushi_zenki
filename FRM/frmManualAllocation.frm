VERSION 5.00
Begin VB.Form frmManualAllocation 
   BackColor       =   &H00FFFFFF&
   ClientHeight    =   9810
   ClientLeft      =   60
   ClientTop       =   345
   ClientWidth     =   14895
   ForeColor       =   &H00FF0000&
   LinkTopic       =   "Form1"
   MDIChild        =   -1  'True
   Picture         =   "frmManualAllocation.frx":0000
   ScaleHeight     =   9810
   ScaleWidth      =   14895
   Tag             =   "2431"
   Visible         =   0   'False
   WindowState     =   2  'ç≈ëÂâª
   Begin VB.TextBox txtExamineeID2 
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   345
      Left            =   8280
      MaxLength       =   4
      TabIndex        =   24
      Top             =   2025
      Width           =   1095
   End
   Begin VB.CommandButton cmdReDisp 
      Caption         =   "éÛå±ê∂ï\é¶"
      Height          =   495
      Left            =   3510
      TabIndex        =   23
      Top             =   1200
      Width           =   1665
   End
   Begin VB.Frame Frame1 
      BackColor       =   &H00C0FFFF&
      Caption         =   "ï\é¶ÉIÉvÉVÉáÉì"
      Height          =   660
      Left            =   510
      TabIndex        =   19
      Top             =   1080
      Width           =   2880
      Begin VB.OptionButton Option3 
         BackColor       =   &H00C0FFFF&
         Caption         =   "ïπäËÇ»Çµ"
         Height          =   270
         Left            =   1650
         TabIndex        =   22
         Top             =   285
         Width           =   960
      End
      Begin VB.OptionButton Option2 
         BackColor       =   &H00C0FFFF&
         Caption         =   "ïπäË"
         Height          =   315
         Left            =   870
         TabIndex        =   21
         Top             =   255
         Width           =   705
      End
      Begin VB.OptionButton Option1 
         BackColor       =   &H00C0FFFF&
         Caption         =   "ëSëÃ"
         Height          =   420
         Left            =   105
         TabIndex        =   20
         Top             =   210
         Width           =   855
      End
   End
   Begin VB.TextBox txtWemenDay1 
      Alignment       =   1  'âEëµÇ¶
      BackColor       =   &H00E0E0E0&
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   330
      Left            =   4605
      Locked          =   -1  'True
      TabIndex        =   18
      Top             =   8085
      Width           =   900
   End
   Begin VB.CommandButton cmdJukenList1 
      Caption         =   "éÛå±ê∂ÉäÉXÉgCSVèoóÕ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   510
      TabIndex        =   16
      Top             =   8520
      Width           =   2900
   End
   Begin VB.CommandButton cmdJukenList2 
      Caption         =   "éÛå±ê∂ÉäÉXÉgCSVèoóÕ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   7095
      TabIndex        =   15
      Top             =   8520
      Width           =   2900
   End
   Begin VB.TextBox txtTotalDay2 
      Alignment       =   1  'âEëµÇ¶
      BackColor       =   &H00E0E0E0&
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   330
      Left            =   8175
      Locked          =   -1  'True
      TabIndex        =   14
      Top             =   8085
      Width           =   900
   End
   Begin VB.TextBox txtTotalDay1 
      Alignment       =   1  'âEëµÇ¶
      BackColor       =   &H00E0E0E0&
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   330
      Left            =   1590
      Locked          =   -1  'True
      TabIndex        =   12
      Top             =   8085
      Width           =   900
   End
   Begin VB.TextBox txtExamineeID1 
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   345
      Left            =   1665
      MaxLength       =   4
      TabIndex        =   8
      Top             =   2025
      Width           =   1095
   End
   Begin VB.TextBox txtWemenDay2 
      Alignment       =   1  'âEëµÇ¶
      BackColor       =   &H00E0E0E0&
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   330
      Left            =   11205
      Locked          =   -1  'True
      TabIndex        =   6
      Top             =   8085
      Width           =   900
   End
   Begin VB.ListBox lstDay1 
      BackColor       =   &H00FFFFFF&
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   5325
      Left            =   510
      MultiSelect     =   2  'ägí£
      Sorted          =   -1  'True
      TabIndex        =   0
      Top             =   2745
      Width           =   5000
   End
   Begin VB.ListBox lstDay2 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   5325
      Left            =   7110
      MultiSelect     =   2  'ägí£
      Sorted          =   -1  'True
      TabIndex        =   2
      Top             =   2745
      Width           =   5000
   End
   Begin VB.CommandButton cmdDeselect 
      Caption         =   "<"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   5775
      TabIndex        =   3
      Top             =   5490
      Width           =   1095
   End
   Begin VB.CommandButton cmdSelect 
      Caption         =   ">"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   5760
      TabIndex        =   1
      Top             =   4575
      Width           =   1095
   End
   Begin VB.Label lblMsg2 
      BackStyle       =   0  'ìßñæ
      Caption         =   "lblMsg2"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   300
      Left            =   7065
      TabIndex        =   26
      Top             =   9240
      Width           =   7515
   End
   Begin VB.Label lblJuken2 
      BackStyle       =   0  'ìßñæ
      Caption         =   "éÛå±î‘çÜ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   225
      Left            =   7110
      TabIndex        =   25
      Top             =   2070
      Width           =   1050
   End
   Begin VB.Label lblWemenDay1 
      Alignment       =   1  'âEëµÇ¶
      BackStyle       =   0  'ìßñæ
      Caption         =   "èóê´"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   300
      Left            =   3780
      TabIndex        =   17
      Top             =   8115
      Width           =   705
   End
   Begin VB.Label lblTotalDay1 
      Alignment       =   1  'âEëµÇ¶
      BackStyle       =   0  'ìßñæ
      Caption         =   "éÛå±ê∂êî"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   360
      Left            =   450
      TabIndex        =   13
      Top             =   8115
      Width           =   1020
   End
   Begin VB.Label lblExamDay2 
      Alignment       =   2  'íÜâõëµÇ¶
      Caption         =   "ééå±ì˙2"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Left            =   7110
      TabIndex        =   11
      Top             =   2460
      Width           =   4980
   End
   Begin VB.Label lblExamDay1 
      Alignment       =   2  'íÜâõëµÇ¶
      BackColor       =   &H00C0C0C0&
      Caption         =   "ééå±ì˙1"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   255
      Left            =   510
      TabIndex        =   10
      Top             =   2460
      Width           =   4980
   End
   Begin VB.Label lblJuken1 
      BackStyle       =   0  'ìßñæ
      Caption         =   "éÛå±î‘çÜ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   225
      Left            =   510
      TabIndex        =   9
      Top             =   2070
      Width           =   1050
   End
   Begin VB.Label lblWemenDay2 
      Alignment       =   1  'âEëµÇ¶
      BackStyle       =   0  'ìßñæ
      Caption         =   "èóê´"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   300
      Left            =   10410
      TabIndex        =   7
      Top             =   8115
      Width           =   645
   End
   Begin VB.Label lblMsg 
      BackStyle       =   0  'ìßñæ
      Caption         =   "lblMsg"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   300
      Left            =   480
      TabIndex        =   5
      Top             =   9240
      Width           =   8130
   End
   Begin VB.Label lblTotalDay2 
      BackStyle       =   0  'ìßñæ
      Caption         =   "éÛå±ê∂êî"
      BeginProperty Font 
         Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00800000&
      Height          =   360
      Left            =   7125
      TabIndex        =   4
      Top             =   8115
      Width           =   1020
   End
End
Attribute VB_Name = "frmManualAllocation"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'*************************************************************************************************
'Form Name      :   frmManualAllocation
'Author         :   Dileep Cherian
'Created On     :   16/05/02
'Description    :   This form is used for maual allocation of examiees for 2nd phase interviews
'Reference      :   Functional Specs Of Manual Allocation Ver 1.0
'***************************************************************************************************
Option Explicit

Dim f_bln_DataChange   As Boolean    'variable to indicate any change operations
Dim f_int_ExamType     As Long       'to identify the exam type

Dim g_iSystemProfileId As Integer


Dim g_dExamDay1        As Date
Dim g_iExamDay1Max     As Long
Dim g_iExamDay1RoomCnt As Long

Dim g_dExamDay2        As Date
Dim g_iExamDay2Max     As Long
Dim g_iExamDay2RoomCnt As Long

Dim g_dExamDay3        As Date
Dim g_iExamDay3Max     As Long
Dim g_iExamDay3RoomCnt As Long

Dim g_ExamDay1Count    As Long       'count of examinees allocated to the selected spl interview/report room

'éwíËÇÃÉEÉBÉìÉhÉEÇ…ÉÅÉbÉZÅ[ÉWÇëóÇÈ(P750)
Private Declare Function SendMessage Lib "user32" _
    Alias "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, _
    ByVal wParam As Long, ByVal lParam As String) As Long

Private Const LB_FINDSTRING = &H18F         'êÊì™àÍívåüçı(P816)
Private Const LB_FINDSTRINGEXACT = &H1A2    'äÆëSàÍívåüçı(P816)



Private Sub Form_Load()

    On Error GoTo ErrorHandler

    Dim kubun    As Integer
    Dim rinf     As Integer


    Call f_void_CheckButtonStatus


    '----------------------
    'ï\é¶ê›íË
    '----------------------
    Option1.Value = True
    Option2.Value = False
    Option3.Value = False


    '----------------------
    'èâä˙ÉfÅ[É^éÊìæä÷êî
    '----------------------
    g_iSystemProfileId = Get_iSystemProfileId(1)
    rinf = Get_Init_Hensu(kubun)

    lblExamDay1.Caption = "ééå±ì˙1 (" & Format(g_dExamDay1, "YYYY/MM/DD") & ")"
    lblExamDay2.Caption = "ééå±ì˙2 (" & Format(g_dExamDay2, "YYYY/MM/DD") & ")"


    '----------------------
    'èâä˙ÉfÅ[É^éÊìæä÷êî
    '----------------------
    lstDay1.Clear ''''2022.01.15 add jhi
    lstDay2.Clear ''''2022.01.15 add jhi

    lblMsg.Caption = ""
    lblMsg2.Caption = ""
 

    Call Set_lstDay1(1)
    Call Set_lstDay2(1)

    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["


End Sub

'*******************************************************************************
'* éÛå±ê∂çƒï\é¶                                                                *
'*******************************************************************************
Private Sub cmdReDisp_Click()

    lblMsg.Caption = ""
    lblMsg2.Caption = ""

''''Debug.Print "option1.Value=" & Option1.Value & " option2.Value=" & Option2.Value & " option3.Value=" & Option3.Value

   If (Option1.Value = True) Then
      Call Set_lstDay1(1)
      Call Set_lstDay2(1)

   ElseIf (Option2.Value = True) Then
      Call Set_lstDay1(2)
      Call Set_lstDay2(2)

   ElseIf (Option3.Value = True) Then
      Call Set_lstDay1(3)
      Call Set_lstDay2(3)

   End If


End Sub

'*******************************************************************************
'* ListBoxÇ…ÉfÅ[É^Çê›íË                                                       *
'*******************************************************************************
Private Sub Set_lstDay1(kubun As Integer)

    On Error GoTo ErrorHandler

    Dim oRs     As New ADODB.Recordset    ' recordset object
    Dim sSQL    As String                 ' SQL string
    
    
    lstDay1.Clear
    g_ExamDay1Count = 0


    sSQL = ""
    sSQL = Make_Day1_sSQL(kubun)

    oRs.Open sSQL, g_obj_Conn

    Do While Not oRs.EOF
        lstDay1.AddItem oRs.Fields("iJukenNumber").Value & _
        " - " & oRs.Fields("vExamineeName").Value & _
        " -" & oRs.Fields("iPreferenceDay1Flag").Value & _
        "-" & oRs.Fields("iPreferenceDay2Flag").Value & _
        "-" & oRs.Fields("iMultipleApplyFlag").Value & _
        "-" & IIf(oRs.Fields("iSex") = 0, "(*)", "")

        g_ExamDay1Count = g_ExamDay1Count + 1
        oRs.MoveNext
    Loop

    oRs.Close
    Set oRs = Nothing


    txtTotalDay1.Text = lstDay1.ListCount
    txtWemenDay1.Text = Get_WemenCount(1)


    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["

End Sub

'******************************************************************************
'* ListBox lstDay2Çê›íËÇ∑ÇÈ                                                  *
'******************************************************************************
Private Sub Set_lstDay2(kubun As Integer)

    On Error GoTo ErrorHandler

    Dim oRs           As New ADODB.Recordset    ' recordset object
    Dim sSQL          As String                 ' SQL string
    

    lstDay2.Clear


    sSQL = ""
    sSQL = Make_Day2_sSQL(kubun)

    oRs.Open sSQL, g_obj_Conn
        
    Do While Not oRs.EOF
        lstDay2.AddItem oRs.Fields("iJukenNumber").Value & _
        " - " & oRs.Fields("vExamineeName").Value & _
        " -" & oRs.Fields("iPreferenceDay1Flag").Value & _
        "-" & oRs.Fields("iPreferenceDay2Flag").Value & _
        "-" & oRs.Fields("iMultipleApplyFlag").Value & _
        "-" & IIf(oRs.Fields("iSex") = 0, "(*)", "")
         oRs.MoveNext
    Loop
       
    oRs.Close
    Set oRs = Nothing

    txtTotalDay2.Text = lstDay2.ListCount
    txtWemenDay2.Text = Get_WemenCount(2)

    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["

End Sub

'*******************************************************************************
'* Åy>Åz ëIëèàóù                                                              *
'*******************************************************************************
Private Sub cmdSelect_Click()

    On Error GoTo ErrorHandler

    Dim oRs              As New ADODB.Recordset    ' recordset object
    Dim sSQL             As String                 ' SQL string

    Dim i                As Long                   ' counter
    Dim icnt             As Long                   ' counter

    Dim l_bln_existing   As Boolean                ' to see whether the examinee is already existing or not
    Dim l_bln_Flag       As Boolean                ' to see whether the examinee is already existing or not
    Dim l_bln_Status     As Boolean                ' to track the return value of the function call
    Dim borinf           As Boolean                ' to track the return value of the function call

    Dim iJukenNo         As Long                   ' to store the juken number
    Dim iExamineeId      As Long                   ' to store the examinee Id
    Dim rinf             As Long                   ' to track the return value of the function call

    Dim sMsg             As String


    
    If lstDay1.SelCount <= 0 Then
        Exit Sub
    End If


    For icnt = 0 To lstDay1.ListCount - 1

        If icnt > lstDay1.ListCount - 1 Then
            Exit For
        End If


        If lstDay1.Selected(icnt) Then

            For i = 0 To lstDay2.ListCount - 1
                If lstDay2.List(i) = lstDay1.List(icnt) Then
                    l_bln_existing = True
                    Exit For
                 End If
            Next i

''''Call log("icnt=" & icnt)

                
            If Not l_bln_existing Then

                 iJukenNo = CLng(Left(lstDay1.List(icnt), 4))
                    
''''2022.02.01 del jhi
''''                 sMsg = ""
''''                 sMsg = sMsg & "ëIëÇµÇΩéÛå±ê∂ÇÃééå±ì˙ÇïœçXÇµÇ‹Ç∑ÅB(éÛå±î‘çÜ=" & iJukenNo & ")" & vbCrLf
''''                 sMsg = sMsg & "é¿çsÇµÇ‹Ç∑Ç©ÅH"
''''
''''                 rinf = MsgBox(sMsg, vbQuestion + vbYesNo, "ämîF")
''''                 If rinf = vbNo Then
''''                     Exit Sub
''''                 End If

                 iExamineeId = Get_iExamineeProfileId(iJukenNo)

                 borinf = ExamDay_Update(iExamineeId, 2)
                 If borinf Then

                     If Not f_bln_DataChange Then
                         f_bln_DataChange = True
                     End If

                     lstDay2.AddItem lstDay1.List(icnt)
                     lstDay1.RemoveItem (icnt)
                     icnt = icnt - 1   ' because an item is removed from the list

                     lblMsg.Caption = "ëIëÇµÇΩéÛå±ê∂ÇÃééå±ì˙ÇïœçXÇµÇ‹ÇµÇΩÅB(éÛå±î‘çÜ=" & Format(iJukenNo, "000#") & ")"
                 End If

            End If

        End If

    Next

''''Call log("2 icnt=" & icnt)


    txtTotalDay1.Text = lstDay1.ListCount
    txtWemenDay1.Text = Get_WemenCount(1)

    txtTotalDay2.Text = lstDay2.ListCount
    txtWemenDay2.Text = Get_WemenCount(2)

''''Call cmdReDisp_Click ''''refresh gamen

    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["

End Sub

'*******************************************************************************
'* Åy<Åz ëIëèàóù                                                              *
'*******************************************************************************
Private Sub cmdDeselect_Click()

    On Error GoTo ErrorHandler

    Dim oRs              As New ADODB.Recordset    ' recordset object
    Dim sSQL             As String                 ' SQL string

    Dim i                As Long                   ' counter
    Dim icnt             As Long                   ' counter

    Dim l_bln_existing   As Boolean                ' to see whether the examinee is already existing or not
    Dim l_bln_Flag       As Boolean                ' to see whether the examinee is already existing or not
    Dim l_bln_Status     As Boolean                ' to track the return value of the function call
    Dim borinf           As Boolean                ' to track the return value of the function call

    Dim iJukenNo         As Long                   ' to store the juken number
    Dim iExamineeId      As Long                   ' to store the examinee Id
    Dim rinf             As Long                   ' to track the return value of the function call

    Dim sMsg             As String


    
    If lstDay2.SelCount <= 0 Then
        Exit Sub
    End If


''''Call log("ListCount-1=" & lstDay2.ListCount - 1)

    For icnt = 0 To (lstDay2.ListCount - 1)

''''Call log("icnt=" & icnt)

        If icnt > lstDay2.ListCount - 1 Then
            Exit For
        End If


        If lstDay2.Selected(icnt) Then

            For i = 0 To (lstDay1.ListCount - 1)
                If lstDay1.List(i) = lstDay2.List(icnt) Then
                    l_bln_existing = True
                    Exit For
                 End If
            Next i
                
            If Not l_bln_existing Then

                 iJukenNo = CLng(Left(lstDay2.List(icnt), 4))
                    
''''2022.02.01 del jhi
''''                 sMsg = ""
''''                 sMsg = sMsg & "ëIëÇµÇΩéÛå±ê∂ÇÃééå±ì˙ÇïœçXÇµÇ‹Ç∑ÅB(éÛå±î‘çÜ=" & iJukenNo & ")" & vbCrLf
''''                 sMsg = sMsg & "é¿çsÇµÇ‹Ç∑Ç©ÅH"
''''
''''                 rinf = MsgBox(sMsg, vbQuestion + vbYesNo, "ämîF")
''''                 If rinf = vbNo Then
''''                     Exit Sub
''''                 End If

                 iExamineeId = Get_iExamineeProfileId(iJukenNo)

                 borinf = ExamDay_Update(iExamineeId, 1)
                 If borinf Then

                     If Not f_bln_DataChange Then
                         f_bln_DataChange = True
                     End If

                     lstDay1.AddItem lstDay2.List(icnt)
                     lstDay2.RemoveItem (icnt)

                     'because an item is removed from the list
                     icnt = icnt - 1

                     lblMsg2.Caption = "ëIëÇµÇΩéÛå±ê∂ÇÃééå±ì˙ÇïœçXÇµÇ‹ÇµÇΩÅB(éÛå±î‘çÜ=" & Format(iJukenNo, "000#") & ")"

                 End If

            End If

        End If

    Next icnt


    txtTotalDay1.Text = lstDay1.ListCount
    txtWemenDay1.Text = Get_WemenCount(1)

    txtTotalDay2.Text = lstDay2.ListCount
    txtWemenDay2.Text = Get_WemenCount(2)

''''Call cmdReDisp_Click ''''refresh gamen

    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["

End Sub

'*******************************************************************************
'* ñ ê⁄ÉfÅ[É^çXêVèàóù                                                          *
'*******************************************************************************
Private Function ExamDay_Update(ByVal iExamineeId As Long, iExamDay_flag As Integer) As Boolean

    On Error GoTo ErrorHandler

    Dim oRs    As New ADODB.Recordset
    Dim sSQL   As String
    
    Dim dtTemp As Date



    g_obj_Conn.BeginTrans


    sSQL = ""
    If iExamDay_flag = 1 Then
        sSQL = sSQL & "UPDATE tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "SET" & vbCrLf
        sSQL = sSQL & "    dtSecondExamDay    = '" & Format(g_dExamDay1, "YYYY/MM/DD") & "'" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag=1 " & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag=0 " & vbCrLf
        sSQL = sSQL & "   ,dtUpdate           = '" & Format(Date, "YYYY/MM/DD") & "'" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iExamineeProfileId=" & iExamineeId & vbCrLf
        sSQL = sSQL & "    and iNendo            =" & g_int_CurrentNendo
    Else
        sSQL = sSQL & "UPDATE tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "SET" & vbCrLf
        sSQL = sSQL & "    dtSecondExamDay    = '" & Format(g_dExamDay2, "YYYY/MM/DD") & "'" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag=0 " & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag=1 " & vbCrLf
        sSQL = sSQL & "   ,dtUpdate           = '" & Format(Date, "YYYY/MM/DD") & "'" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iExamineeProfileId=" & iExamineeId
        sSQL = sSQL & "    and iNendo            =" & g_int_CurrentNendo
    End If

    g_obj_Conn.Execute sSQL

    g_obj_Conn.CommitTrans

    ExamDay_Update = True
    Exit Function

ErrorHandler:
    g_obj_Conn.RollbackTrans
    MsgBox "ÇQéüééå±ì˙ïœçXèàóùÇ≈ÉGÉâÅ[Ç™î≠ê∂ÇµÇ‹ÇµÇΩÅB(ExamDay_Update)", vbInformation, "ÉGÉâÅ["
    ExamDay_Update = False

End Function

Private Function Get_WemenCount(kubun As Integer) As Integer

    Dim i         As Long
    Dim iWemenCnt As Long

    iWemenCnt = 0

    If kubun = 1 Then
        For i = 0 To lstDay1.ListCount - 1
            If InStr(lstDay1.List(i), "(*)") = 0 Then
                iWemenCnt = iWemenCnt + 1
            End If
        Next
    Else
        For i = 0 To lstDay2.ListCount - 1
            If InStr(lstDay2.List(i), "(*)") = 0 Then
                iWemenCnt = iWemenCnt + 1
            End If
        Next
    End If


    Get_WemenCount = iWemenCnt


End Function

Private Sub Form_Activate()

    Dim i As Long

    fMainForm.mnuTools.Enabled = False

    For i = 1 To fMainForm.Toolbar1.Buttons.Count
       fMainForm.Toolbar1.Buttons(i).Enabled = False
    Next i

End Sub

'2022.01.21 add jhi
Private Function Get_iSystemProfileId(id As Integer) As Integer

    Get_iSystemProfileId = id

End Function

Private Function Get_Init_Hensu(ikubun As Integer) As Integer

    On Error GoTo ErrorHandler

    Dim oRs    As New ADODB.Recordset
    Dim sSQL   As String

    Dim rinf   As Integer


    rinf = 0

    '2éüééå±ì˙ÇÃì˙ïtÇéÊìæÇ∑ÇÈ
    sSQL = ""
    sSQL = sSQL & "SELECT" & vbCrLf
    sSQL = sSQL & "    dtSecondExamDay1" & vbCrLf
    sSQL = sSQL & "   ,dtSecondExamDay2" & vbCrLf
    sSQL = sSQL & "   ,dtSecondExamDay3" & vbCrLf
    sSQL = sSQL & "   ,iNumberOfExamineeDay1" & vbCrLf
    sSQL = sSQL & "   ,iNumberOfExamineeDay2" & vbCrLf
    sSQL = sSQL & "   ,iNumberOfExamineeDay3" & vbCrLf
    sSQL = sSQL & "   ,iNumberOfRoomDay1" & vbCrLf
    sSQL = sSQL & "   ,iNumberOfRoomDay2" & vbCrLf
    sSQL = sSQL & "   ,iNumberOfRoomDay3" & vbCrLf
    sSQL = sSQL & " FROM" & vbCrLf
    sSQL = sSQL & "     tbSTESecondExamProfile" & vbCrLf
    sSQL = sSQL & " WHERE" & vbCrLf
    sSQL = sSQL & "     iSystemProfileId = 1" & vbCrLf

'SELECT
'    dtSecondExamDay1
'   ,dtSecondExamDay2
'   ,dtSecondExamDay3
'   ,iNumberOfExamineeDay1
'   ,iNumberOfExamineeDay2
'   ,iNumberOfExamineeDay3
'   ,iNumberOfRoomDay1
'   ,iNumberOfRoomDay2
'   ,iNumberOfRoomDay3
'From
'    tbSTESecondExamProfile
'Where
'    iSystemProfileId = 1

    oRs.Open sSQL, g_obj_Conn


    '2éüééå±ì˙ÇéÊìæÇ∑ÇÈ
    If Not oRs.EOF Then

        'ééå±ì˙: ëÊàÍì˙Å@ì˙ït
        g_dExamDay1 = oRs("dtSecondExamDay1")
        g_iExamDay1Max = oRs("iNumberOfExamineeDay1")
        g_iExamDay1RoomCnt = oRs("iNumberOfRoomDay1")

        'ééå±ì˙: ëÊìÒì˙Å@ì˙ït
        g_dExamDay2 = oRs("dtSecondExamDay2")
        g_iExamDay2Max = oRs("iNumberOfExamineeDay2")
        g_iExamDay2RoomCnt = oRs("iNumberOfRoomDay2")

        'ééå±ì˙: ëÊéOì˙Å@ì˙ït
'        g_dExamDay3 = oRS("dtSecondExamDay3")
'        g_iExamDay3Max = oRS("iNumberOfExamineeDay3")
'        g_iExamDay3RoomCnt = oRS("iNumberOfRoomDay3")

    End If

    oRs.Close
    Set oRs = Nothing


    Get_Init_Hensu = rinf

    Exit Function

ErrorHandler:
    MsgBox Err.Description, vbInformation, "Get_Init_HensuÉGÉâÅ["


End Function

Private Function Get_iExamineeProfileId(ByVal iJukenNo As Long) As Long

    On Error GoTo ErrorHandler

    Dim oRs            As New ADODB.Recordset
    Dim sSQL           As String
    
    Dim iExamineeId    As Long


    sSQL = ""
    sSQL = sSQL & "SELECT" & vbCrLf
    sSQL = sSQL & "    iExamineeProfileId" & vbCrLf
    sSQL = sSQL & "FROM" & vbCrLf
    sSQL = sSQL & "    tbSTEExamineeProfile" & vbCrLf
    sSQL = sSQL & "WHERE" & vbCrLf
    sSQL = sSQL & "        iNendo      =" & g_int_CurrentNendo & vbCrLf
    sSQL = sSQL & "    and iJukenNumber=" & iJukenNo

    oRs.Open sSQL, g_obj_Conn

    If Not oRs.EOF Then
        iExamineeId = oRs("iExamineeProfileId")
    End If

    oRs.Close
    Set oRs = Nothing

    Get_iExamineeProfileId = iExamineeId
    Exit Function

ErrorHandler:
    MsgBox Err.Description, vbInformation, "Get_iExamineeProfileIdÉGÉâÅ["
    Get_iExamineeProfileId = 0

End Function

'*******************************************************************************
'*                                                                             *
'*******************************************************************************
Public Sub f_void_CheckButtonStatus()

    If lstDay1.ListCount = 0 Then
        cmdSelect.Enabled = False
    Else
        If lstDay1.SelCount > 0 Then
            cmdSelect.Enabled = True
        Else
            cmdSelect.Enabled = False
        End If
    End If

    
    If lstDay2.ListCount = 0 Then
        cmdDeselect.Enabled = False
    Else
        If lstDay2.SelCount > 0 Then
            cmdDeselect.Enabled = True
        Else
            cmdDeselect.Enabled = False
        End If
    End If

End Sub

Private Sub lstDay1_Click()
    Call f_void_CheckButtonStatus
End Sub

Private Sub lstDay2_Click()
    Call f_void_CheckButtonStatus
End Sub

Private Sub Form_Unload(Cancel As Integer)

    Call g_void_CloseChildForm

End Sub

'*******************************************************************************
'* lstDay1ÇÃÉfÅ[É^íäèoSQLï∂çÏê¨                                                *
'*******************************************************************************
Private Function Make_Day1_sSQL(kubun As Integer) As String

    Dim sSQL As String


    sSQL = ""

    If kubun = 1 Then
       
        sSQL = sSQL & "SELECT" & vbCrLf
        sSQL = sSQL & "    dbo.usfMakeDispJukenNumber(iJukenNumber) as iJukenNumber" & vbCrLf
        sSQL = sSQL & "   ,substring( vExamineeName + 'Å@Å@Å@Å@Å@Å@Å@Å@Å@Å@' , 1 , 8 ) as vExamineeName" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay3Flag" & vbCrLf
        sSQL = sSQL & "   ,iMultipleApplyFlag" & vbCrLf    'ïπäËflag
        sSQL = sSQL & "   ,iSex" & vbCrLf
        sSQL = sSQL & "FROM" & vbCrLf
        sSQL = sSQL & "     tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iNendo          =" & g_int_CurrentNendo & vbCrLf
        sSQL = sSQL & "    AND iExamineeStatus =" & gclExamineeStatus_1stPass & vbCrLf
        sSQL = sSQL & "    AND dtSecondExamDay ='" & Format(g_dExamDay1, "YYYY/MM/DD") & "'"

    ElseIf (kubun = 2) Then 'ïπäËé“ÇÃÇ›

        sSQL = sSQL & "SELECT" & vbCrLf
        sSQL = sSQL & "    dbo.usfMakeDispJukenNumber(iJukenNumber) as iJukenNumber" & vbCrLf
        sSQL = sSQL & "   ,substring( vExamineeName + 'Å@Å@Å@Å@Å@Å@Å@Å@Å@Å@' , 1 , 8 ) as vExamineeName" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay3Flag" & vbCrLf
        sSQL = sSQL & "   ,iMultipleApplyFlag" & vbCrLf    'ïπäËflag
        sSQL = sSQL & "   ,iSex" & vbCrLf
        sSQL = sSQL & "FROM" & vbCrLf
        sSQL = sSQL & "     tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iNendo          =" & g_int_CurrentNendo & vbCrLf
        sSQL = sSQL & "    AND iExamineeStatus =" & gclExamineeStatus_1stPass & vbCrLf
        sSQL = sSQL & "    AND dtSecondExamDay ='" & Format(g_dExamDay1, "YYYY/MM/DD") & "'"
        sSQL = sSQL & "    AND iMultipleApplyFlag =1" 'ïπäËé“

    ElseIf (kubun = 3) Then 'ïπäËé“Ç≈ÇÕÇ»Ç¢

        sSQL = sSQL & "SELECT" & vbCrLf
        sSQL = sSQL & "    dbo.usfMakeDispJukenNumber(iJukenNumber) as iJukenNumber" & vbCrLf
        sSQL = sSQL & "   ,substring( vExamineeName + 'Å@Å@Å@Å@Å@Å@Å@Å@Å@Å@' , 1 , 8 ) as vExamineeName" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay3Flag" & vbCrLf
        sSQL = sSQL & "   ,iMultipleApplyFlag" & vbCrLf    'ïπäËflag
        sSQL = sSQL & "   ,iSex" & vbCrLf
        sSQL = sSQL & "FROM" & vbCrLf
        sSQL = sSQL & "     tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iNendo          =" & g_int_CurrentNendo & vbCrLf
        sSQL = sSQL & "    AND iExamineeStatus =" & gclExamineeStatus_1stPass & vbCrLf
        sSQL = sSQL & "    AND dtSecondExamDay ='" & Format(g_dExamDay1, "YYYY/MM/DD") & "'"
        sSQL = sSQL & "    AND iMultipleApplyFlag =0" 'ïπäËé“Ç≈ÇÕÇ»Ç¢
    Else
        MsgBox "Make_Day1_sSQL: ÉpÉâÉÅÅ[É^ÉGÉâÅ[(" & kubun & ")"
    End If


    Make_Day1_sSQL = sSQL
  

    Exit Function

End Function

'*******************************************************************************
'* lstDay2ÇÃÉfÅ[É^íäèoSQLï∂çÏê¨                                                *
'*******************************************************************************
Private Function Make_Day2_sSQL(kubun As Integer) As String

    Dim sSQL As String


    sSQL = ""

    If kubun = 1 Then
       
        sSQL = sSQL & "SELECT" & vbCrLf
        sSQL = sSQL & "    dbo.usfMakeDispJukenNumber(iJukenNumber) as iJukenNumber" & vbCrLf
        sSQL = sSQL & "   ,substring( vExamineeName + 'Å@Å@Å@Å@Å@Å@Å@Å@Å@Å@' , 1 , 8 ) as vExamineeName" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay3Flag" & vbCrLf
        sSQL = sSQL & "   ,iMultipleApplyFlag" & vbCrLf    'ïπäËflag
        sSQL = sSQL & "   ,iSex" & vbCrLf
        sSQL = sSQL & "FROM" & vbCrLf
        sSQL = sSQL & "     tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iNendo          =" & g_int_CurrentNendo & vbCrLf
        sSQL = sSQL & "    AND iExamineeStatus =" & gclExamineeStatus_1stPass & vbCrLf
        sSQL = sSQL & "    AND dtSecondExamDay ='" & Format(g_dExamDay2, "YYYY/MM/DD") & "'"

    ElseIf (kubun = 2) Then 'ïπäËé“ÇÃÇ›

        sSQL = sSQL & "SELECT" & vbCrLf
        sSQL = sSQL & "    dbo.usfMakeDispJukenNumber(iJukenNumber) as iJukenNumber" & vbCrLf
        sSQL = sSQL & "   ,substring( vExamineeName + 'Å@Å@Å@Å@Å@Å@Å@Å@Å@Å@' , 1 , 8 ) as vExamineeName" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay3Flag" & vbCrLf
        sSQL = sSQL & "   ,iMultipleApplyFlag" & vbCrLf    'ïπäËflag
        sSQL = sSQL & "   ,iSex" & vbCrLf
        sSQL = sSQL & "FROM" & vbCrLf
        sSQL = sSQL & "     tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iNendo          =" & g_int_CurrentNendo & vbCrLf
        sSQL = sSQL & "    AND iExamineeStatus =" & gclExamineeStatus_1stPass & vbCrLf
        sSQL = sSQL & "    AND dtSecondExamDay ='" & Format(g_dExamDay2, "YYYY/MM/DD") & "'"
        sSQL = sSQL & "    AND iMultipleApplyFlag =1" 'ïπäËé“

    ElseIf (kubun = 3) Then 'ïπäËé“Ç≈ÇÕÇ»Ç¢

        sSQL = sSQL & "SELECT" & vbCrLf
        sSQL = sSQL & "    dbo.usfMakeDispJukenNumber(iJukenNumber) as iJukenNumber" & vbCrLf
        sSQL = sSQL & "   ,substring( vExamineeName + 'Å@Å@Å@Å@Å@Å@Å@Å@Å@Å@' , 1 , 8 ) as vExamineeName" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay1Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay2Flag" & vbCrLf
        sSQL = sSQL & "   ,iPreferenceDay3Flag" & vbCrLf
        sSQL = sSQL & "   ,iMultipleApplyFlag" & vbCrLf    'ïπäËflag
        sSQL = sSQL & "   ,iSex" & vbCrLf
        sSQL = sSQL & "FROM" & vbCrLf
        sSQL = sSQL & "     tbSTEExamineeProfile" & vbCrLf
        sSQL = sSQL & "WHERE" & vbCrLf
        sSQL = sSQL & "        iNendo          =" & g_int_CurrentNendo & vbCrLf
        sSQL = sSQL & "    AND iExamineeStatus =" & gclExamineeStatus_1stPass & vbCrLf
        sSQL = sSQL & "    AND dtSecondExamDay ='" & Format(g_dExamDay2, "YYYY/MM/DD") & "'"
        sSQL = sSQL & "    AND iMultipleApplyFlag =0" 'ïπäËé“Ç≈ÇÕÇ»Ç¢
    Else
        MsgBox "Make_Day2_sSQL: ÉpÉâÉÅÅ[É^ÉGÉâÅ[(" & kubun & ")"
    End If


    Make_Day2_sSQL = sSQL
  

    Exit Function

End Function


'*******************************************************************************
'* ééå±ì˙ïœçX                                                                  *
'* ç∂ListBoxÉfÅ[É^csvèoóÕ                                                      *
'* 2022.01.16 update jhi                                                       *
'*******************************************************************************
Private Sub cmdJukenList1_Click()

    On Error GoTo ErrorHandler

    Dim fso                   As Object
    Dim objText               As Object
    Dim strFile               As String
    Dim blnOpenFile           As Boolean

    Dim sJukenNo              As String
    Dim sJukenNm              As String
    Dim icnt                  As Integer

    Dim strLine               As String


    If lstDay1.ListCount < 1 Then
        cmdJukenList1.Enabled = False
        Exit Sub
    End If

    cmdJukenList1.Enabled = True


    blnOpenFile = False

    'FSOÉIÉuÉWÉFÉNÉbÉgÇèâä˙âª
    strFile = App.Path & "\Report\éÛå±ê∂àÍóó_" & "ëÊàÍì˙" & "_" & Format(Now(), "YYYYMMDDHHmmSS") & ".csv"

    Set fso = CreateObject("Scripting.FileSystemObject")
    Set objText = fso.CreateTextFile(strFile, True, False)

    blnOpenFile = True

    sJukenNo = ""    'éÛå±ê∂No
    sJukenNm = ""    'éÛå±ñº


    '---------------------------------------------------------------------------
    'ê›íËÉpÉâÉÅÅ[É^ÇÉtÉ@ÉCÉãÇ…èoóÕ
    '---------------------------------------------------------------------------
    strLine = "ñ ê⁄ì˙: " & g_dExamDay1 & "," & ",,"
    objText.WriteLine (strLine)


    '---------------------------------------------------------------------------
    'HeaderÇÉtÉ@ÉCÉãÇ…èoóÕ
    '---------------------------------------------------------------------------
    strLine = "No,îNìx,éÛå±î‘çÜ,éÛå±ê∂ñº"
    objText.WriteLine (strLine)


    '---------------------------------------------------------------------------
    'ListBoxÇÃì‡óeÇÉtÉ@ÉCÉãÇ…èoóÕ
    '---------------------------------------------------------------------------
    For icnt = 0 To lstDay1.ListCount - 1
        sJukenNo = Left(lstDay1.List(icnt), 4)

        sJukenNm = Mid(lstDay1.List(icnt), 7, 8)
        sJukenNm = Trim(sJukenNm)
        strLine = icnt + 1 & "," & g_int_CurrentNendo & "," & sJukenNo & "," & sJukenNm
        objText.WriteLine (strLine)
    Next

    If blnOpenFile = True Then
        blnOpenFile = False
        objText.Close
        Set objText = Nothing
        Set fso = Nothing
    End If

    ShellExecute Me.hWnd, "open", strFile, vbNullString, vbNullString, 1

    Exit Sub


ErrorHandler:

    If blnOpenFile = True Then
        blnOpenFile = False
        objText.Close
        Set objText = Nothing
        Set fso = Nothing
    End If
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ[(ëÊàÍì˙)"

End Sub

'*******************************************************************************
'* ééå±ì˙ïœçX                                                                  *
'* âEListBoxÉfÅ[É^csvèoóÕ                                                      *
'* 2022.01.16 update jhi                                                       *
'*******************************************************************************
Private Sub cmdJukenList2_Click()

    On Error GoTo ErrorHandler

    Dim fso                   As Object
    Dim objText               As Object
    Dim strFile               As String
    Dim blnOpenFile           As Boolean

    Dim sJukenNo              As String
    Dim sJukenNm              As String
    Dim icnt                  As Integer

    Dim strLine               As String
    

    If lstDay2.ListCount < 1 Then
        cmdJukenList2.Enabled = False
        Exit Sub
    End If

    cmdJukenList2.Enabled = True

    blnOpenFile = False


    'FSOÉIÉuÉWÉFÉNÉbÉgÇèâä˙âª
    strFile = App.Path & "\Report\éÛå±ê∂àÍóó_" & "ëÊìÒì˙" & "_" & Format(Now(), "YYYYMMDDHHmmSS") & ".csv"

    Set fso = CreateObject("Scripting.FileSystemObject")
    Set objText = fso.CreateTextFile(strFile, True, False)

    blnOpenFile = True

    sJukenNo = ""    'éÛå±ê∂No
    sJukenNm = ""    'éÛå±ñº


    '---------------------------------------------------------------------------
    'ê›íËÉpÉâÉÅÅ[É^ÇÉtÉ@ÉCÉãÇ…èoóÕ
    '---------------------------------------------------------------------------
    strLine = "ñ ê⁄ì˙: " & g_dExamDay2 & "," & ",,"
    objText.WriteLine (strLine)


    '---------------------------------------------------------------------------
    'HeaderÇÉtÉ@ÉCÉãÇ…èoóÕ
    '---------------------------------------------------------------------------
    strLine = "No,îNìx,éÛå±î‘çÜ,éÛå±ê∂ñº"
    objText.WriteLine (strLine)


    '---------------------------------------------------------------------------
    'ListBoxÇÃì‡óeÇÉtÉ@ÉCÉãÇ…èoóÕ
    '---------------------------------------------------------------------------
    For icnt = 0 To lstDay2.ListCount - 1

        sJukenNo = Left(lstDay2.List(icnt), 4)

        sJukenNm = Mid(lstDay2.List(icnt), 7, 8)
        sJukenNm = Trim(sJukenNm)
        strLine = icnt + 1 & "," & g_int_CurrentNendo & "," & sJukenNo & "," & sJukenNm
        objText.WriteLine (strLine)
    Next

    If blnOpenFile = True Then
        blnOpenFile = False
        objText.Close
        Set objText = Nothing
        Set fso = Nothing
    End If

    ShellExecute Me.hWnd, "open", strFile, vbNullString, vbNullString, 1

    Exit Sub


ErrorHandler:

    If blnOpenFile = True Then
        blnOpenFile = False
        objText.Close
        Set objText = Nothing
        Set fso = Nothing
    End If
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ[(ëÊìÒì˙)"

End Sub

'******************************************************************************
'* éÛå±î‘çÜì¸óÕÇ≈ééå±ì˙ÇÃïœçX                                                 *
'* 2022.02.01 add jhi                                                         *
'******************************************************************************
Private Sub txtExamineeID1_KeyPress(KeyAscii As Integer)
 
    On Error GoTo ErrorHandler

    Dim oRs              As New ADODB.Recordset    ' recordset object
    Dim sSQL             As String                 ' SQL string

    Dim i                As Long                   ' counter
    Dim icnt             As Long                   ' counter
    Dim idx              As Integer

    Dim l_bln_existing   As Boolean                ' to see whether the examinee is already existing or not
    Dim borinf           As Boolean                ' to track the return value of the function call

    Dim sJukenNo         As String                 ' to store the juken number
    Dim iExamineeId      As Long                   ' to store the examinee Id
    Dim rinf             As Long                   ' to track the return value of the function call

    Dim sMsg             As String
    

    
    If (KeyAscii < 48 Or KeyAscii > 57) And KeyAscii <> 8 And KeyAscii <> 13 Then
        KeyAscii = 0
        Exit Sub
    End If


    lblMsg.Caption = ""

    '---------------------------------------------------------------------------
    'Enter KeyÇÃèàóù
    '---------------------------------------------------------------------------
    If KeyAscii = 13 Then
        
        If Trim(txtExamineeID1.Text) = "" Then
            Exit Sub
        End If

        lblMsg.Caption = ""
        lblMsg2.Caption = ""
    

 
        'ÉäÉXÉgåèêîï™ÉãÅ[ÉvÇµÇƒSelectedÇFalseÇ…Ç∑ÇÈ
        For i = 0 To Me.lstDay1.ListCount - 1
            lstDay1.Selected(i) = False
        Next i


        sJukenNo = Format(txtExamineeID1.Text, "000#")
        idx = fLBSearch(lstDay1, sJukenNo, 0)
        If idx = -1 Then
            MsgBox "éwíËÇÃéÛå±î‘çÜÇÕìoò^Ç≥ÇÍÇƒÇ¢Ç‹ÇπÇÒÅBÇ≤ämîFÇ≠ÇæÇ≥Ç¢ÅB"
            Exit Sub
        Else
''''        MsgBox "Ç∑Ç≈Ç…ìoò^Ç≥ÇÍÇƒÇ¢Ç‹Ç∑ÅB"
            lstDay1.Selected(idx) = True
        End If

        Call cmdSelect_Click

    End If

    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["

End Sub

'******************************************************************************
'* éÛå±î‘çÜì¸óÕÇ≈ééå±ì˙ÇÃïœçX                                                 *
'* 2022.02.01 add jhi                                                         *
'******************************************************************************
Private Sub txtExamineeID2_KeyPress(KeyAscii As Integer)
 
    On Error GoTo ErrorHandler

    Dim oRs              As New ADODB.Recordset    ' recordset object
    Dim sSQL             As String                 ' SQL string

    Dim i                As Long                   ' counter
    Dim icnt             As Long                   ' counter
    Dim idx              As Integer

    Dim l_bln_existing   As Boolean                ' to see whether the examinee is already existing or not
    Dim borinf           As Boolean                ' to track the return value of the function call

    Dim sJukenNo         As String                 ' to store the juken number
    Dim iExamineeId      As Long                   ' to store the examinee Id
    Dim rinf             As Long                   ' to track the return value of the function call

    Dim sMsg             As String
    

    
    If (KeyAscii < 48 Or KeyAscii > 57) And KeyAscii <> 8 And KeyAscii <> 13 Then
        KeyAscii = 0
        Exit Sub
    End If


    lblMsg2.Caption = ""

    '---------------------------------------------------------------------------
    'Enter KeyÇÃèàóù
    '---------------------------------------------------------------------------
    If KeyAscii = 13 Then
        
        If Trim(txtExamineeID2.Text) = "" Then
            Exit Sub
        End If
 
        lblMsg.Caption = ""
        lblMsg2.Caption = ""


        'ÉäÉXÉgåèêîï™ÉãÅ[ÉvÇµÇƒSelectedÇFalseÇ…Ç∑ÇÈ
        For i = 0 To Me.lstDay1.ListCount - 1
            lstDay1.Selected(i) = False
        Next i


        sJukenNo = Format(txtExamineeID2.Text, "000#")
        idx = fLBSearch(lstDay2, sJukenNo, 0)
        If idx = -1 Then
            MsgBox "éwíËéÛå±î‘çÜÇÕìoò^Ç≥ÇÍÇƒÇ¢Ç‹ÇπÇÒÅBÇ≤ämîFÇ≠ÇæÇ≥Ç¢ÅB"
            Exit Sub
        Else
''''        MsgBox "Ç∑Ç≈Ç…ìoò^Ç≥ÇÍÇƒÇ¢Ç‹Ç∑ÅB"
            lstDay2.Selected(idx) = True
        End If

        Call cmdDeselect_Click

    End If

    Exit Sub

ErrorHandler:
    MsgBox Err.Description, vbInformation, "ÉGÉâÅ["

End Sub



'=================================================================
' éwíËÇÃï∂éöóÒÇ™ÉäÉXÉgÉ{ÉbÉNÉXì‡Ç…Ç†ÇÈÇ©åüçıÇ∑ÇÈä÷êî
'Å@LBoxÅ@Å@ Å@ÅFåüçıÇ∑ÇÈÉäÉXÉgÉ{ÉbÉNÉXñº
'Å@SearchStrÅ@ÅFåüçıÇ∑ÇÈï∂éöóÒ
'Å@ExactÅ@Å@Å@ÅFåüçıï˚ñ@Å@1<>ëOï˚àÍívåüçıÅ@1=äÆëSàÍívåüçı
'Å@fLBSearchÅ@ÅFñﬂÇËílÅ@å©Ç¬Ç©Ç¡ÇΩèÍçá=ÉCÉìÉfÉbÉNÉX ÇªÇÍà»äO = -1
'==================================================================
Private Function fLBSearch(LBox As ListBox, ByVal SearchStr As String, Optional ByVal Exact As Integer = 0) As Integer
    Dim Ret As Long
    If Exact = 1 Then
        Ret = SendMessage(LBox.hWnd, LB_FINDSTRINGEXACT, -1, SearchStr)
    Else
        Ret = SendMessage(LBox.hWnd, LB_FINDSTRING, -1, SearchStr)
    End If

    LBox.ListIndex = Ret
    fLBSearch = Ret

End Function

